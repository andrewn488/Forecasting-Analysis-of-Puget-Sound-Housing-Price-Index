---
title: "OSMBA 5305 DTC - Forecasting Home Price Index"
author: "Eric Beekman, Jonathan Burns, Vishaal Diwan, Glen Lewis, and Andrew Nalundasan"
output:
  slidy_presentation:
    theme: cerulean
---

 
```{r echo = FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
library(dynlm)
library(forecast)
library(vtable)
library (lubridate)
library(scales)
library(patchwork)
library(stats)
library(tseries)

# loads csv into a base data frame
base_housing_data <- read_csv("fmhpi_master_file.csv")

# the following code will filter the base data_housing_data building a data frame for only the Seattle-Tacoma-Bellevue WA area from 1975 to 2019. This "pre-covid" time frame ends in Dec 2019. While the WHO did not declare COVID-19 a pandemic until March 2020, the effect of the disease on work, employment, etc. was already manifesting in February (Changes to the following code per the Professor's guidance 11/18/21). 

base_puget_precovid_data <- filter(base_housing_data, GEO_Name == 
                            'Seattle-Tacoma-Bellevue WA') %>% 
                            filter(Year <= 2019)

# Creates a new YearMonth date variable as a date class (day is set to 01)

base_puget_precovid_data$YearMonth <- as.Date(with(base_puget_precovid_data,paste(Year, Month, 1, sep="-")),"%Y-%m-%d") 
  
# Narrows the number of variables by removing the Code variables and then reorders the variables. The not seasonally adjust variable was removed per the Professor's guidance 11/18/21)
wip_puget_precovid_data <- base_puget_precovid_data %>% 
  select(YearMonth, Index_SA)
```

Introduction
=======================================
<div style="float: left; width: 50%;">

+ Forecasting Housing Prices

- Housing price growth has exploded in recent months and house prices in general have increased from 1975 onward.
- Vital to lenders, individuals, and government officials to monitor changes in house prices over time to appropriately plan for home ownership and changes in housing affordability at scale.

+ Research Question

- How did the pandemic impact the behavior of the housing price index and what is the appropriate scheme (fixed, recursive, or rolling) that will help us best forecast the housing price index values after the pandemic?

</div>
<div style="float: right; width: 50%;">
```{r echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=6}
# The following code plots the data to determine stationarity 

# Converts the data to 2 time series
index_sa_ts <- ts(wip_puget_precovid_data$Index_SA, frequency = 12, start = c(1975))

# The following plots the not seasonally adjusted (nsa) index then assesses the acf and pacf.
plot(index_sa_ts, main = 'Freddie Mac Seasonally Adjusted Housing Price Index
     2011 - 2019 ', ylab = 'Housing Index', xlab = 'Year', col = 'blue')
```
</div>

Data Description
=========================================

We used the Freddie Mac House Price Index (FMPHI) available at http://www.freddiemac.com/research/indices/house-price-index.page.

- The FMHPI provides a measure of typical price inflation for houses within the United States.
- Values are calculated monthly and released at the end of the following month.
- The data includes seasonally and non-seasonally adjusted series which are available at three different geographical levels (metropolitan, state, and national).
- The data set includes each month from January 1975 onward.

Housing Data
=========================================
<div style="float: left; width: 50%;">

- The log/diff of the index 
```{r echo = FALSE, message = FALSE, warning = FALSE, fig.height=5, fig.width=6}
log_diff_sa_ts <- diff(log(index_sa_ts))

plot(log_diff_sa_ts, main = 'Log/Diff of Seasonally Adjusted Housing Index', ylab = 'Log Difference', xlab = 'Year', col = "blue")
abline(h = '.0053')
text(1978, .0065, "Unconditional", cex = .4, col = 'black')
text(1978, .0040, "Mean", cex = .4, col = 'black')
```
</div>
<div style="float: left; width: 50%;">
- Stationarity

- The Augmented Dickey-Fuller Test shows we can reject the null hypothesis that the log/diff of the index is stationary.

ADF stat: -3.2 / ADF critical Stat: -2.8

```{r echo = FALSE, message = FALSE, warning = FALSE}
# The following code log diff's the na index to make them stationary.
log_diff_sa_ts <- diff(log(index_sa_ts))

adf.test(log_diff_sa_ts)
```
</div>

Model Selection
==============================
<div style="float: left; width: 50%;">

- Based on the ACF and PACF we elected to start with an AR(3) and AR(16) Model

- AR(3)
puget_housing_obs_ts ~
      stats::lag(puget_housing_obs_ts, -1) +
      stats::lag(puget_housing_obs_ts, -2) + 
      stats::lag(puget_housing_obs_ts, -3)

- AR(16)
puget_housing_obs_ts ~          
      stats::lag(puget_housing_obs_ts, -1) +
      stats::lag(puget_housing_obs_ts, -2) + 
      stats::lag(puget_housing_obs_ts, -3) +
      stats::lag(puget_housing_obs_ts, -11) +
      stats::lag(puget_housing_obs_ts, -12) + 
      stats::lag(puget_housing_obs_ts, -13) + 
      stats::lag(puget_housing_obs_ts, -14) + 
      stats::lag(puget_housing_obs_ts, -15) + 
      stats::lag(puget_housing_obs_ts, -16)
</div>
<div style="float: left; width: 50%;">
```{r echo=FALSE, fig.height=3, fig.width=4, message=FALSE, warning=FALSE}
# The following builds the acf and pacf plots for the stationary time series plots.

ggAcf(log_diff_sa_ts) +
  ylim(c(-.5, 1)) +
  theme_classic() + 
  ggtitle('ACF') +
  labs(y = ' ')
  
```

```{r echo = FALSE, message = FALSE, warning = FALSE, fig.height=3, fig.width=4}

ggPacf(log_diff_sa_ts) +
  ylim(c(-.5, 1)) +
  theme_classic() + 
  ggtitle('PACF') +
  labs(y = ' ') 
```
</div>

Forecasting Models
=========================================

+ Schemes
+ Forecasts




![](Forecast from ARIMA(3,0,0) with non-zero mean.png){width=500px height=500px}

Conclusions and next steps
=========================================

+ Determine the most appropriate models and schemes

    + Fixed scheme
    + Recursive scheme
    + Rolling scheme
    
+ MSE 


